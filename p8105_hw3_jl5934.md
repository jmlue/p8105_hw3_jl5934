p8105_hw3_jl5934
================
Jesus Luevano
2023-10-06

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(p8105.datasets)
data("instacart")
data("brfss_smart2010")
```

# Problem 1

## Describing the dataset

- There are 1384617 rows and 15 columns in the `instacart` dataframe.

- The variables included are order_id, product_id, add_to_cart_order,
  reordered, user_id, eval_set, order_number, order_dow,
  order_hour_of_day, days_since_prior_order, product_name, aisle_id,
  department_id, aisle, department.

- There are 134 aisles in the dataframe.

``` r
instacart %>%
  group_by(aisle_id) %>%
  summarize(n_obs = n())
```

    ## # A tibble: 134 × 2
    ##    aisle_id n_obs
    ##       <int> <int>
    ##  1        1  2936
    ##  2        2  3873
    ##  3        3 17449
    ##  4        4  9917
    ##  5        5  2905
    ##  6        6  1795
    ##  7        7  1526
    ##  8        8  1501
    ##  9        9  9736
    ## 10       10   448
    ## # ℹ 124 more rows

- The top 3 aisles from where purchases are ordered from are Aisle 83
  (150609 purchases), 24 (150473 purchases), and 123 (78493 purchases).

``` r
instacart %>%
  group_by(aisle_id) %>%
  summarize(n_obs = n()) %>%
  filter(n_obs > 10000) %>%
  arrange(desc(n_obs)) %>%
  ggplot(aes(x = aisle_id, y = n_obs)) +
  geom_point() +
  xlab("Aisle ID") + ylab("Observations")
```

![](p8105_hw3_jl5934_files/figure-gfm/plot%20aisles-1.png)<!-- -->

``` r
a <- instacart %>%
  filter(aisle == c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% #filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits")
  group_by(aisle, product_name) %>%
  summarize(n_obs = n()) %>%  #count(product_name = "n_obs")
  arrange(desc(n_obs)) %>%
  slice_max(order_by = n_obs, n = 3) %>%
  knitr::kable()
```

    ## `summarise()` has grouped output by 'aisle'. You can override using the
    ## `.groups` argument.

``` r
instacart %>%
  filter(product_name == c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(Mean = mean(order_hour_of_day, na.rm = TRUE)) %>%
  pivot_wider(
    names_from = order_dow,
    values_from = Mean
  ) %>%
knitr::kable()
```

    ## Warning: There was 1 warning in `filter()`.
    ## ℹ In argument: `product_name == c("Pink Lady Apples", "Coffee Ice Cream")`.
    ## Caused by warning in `product_name == c("Pink Lady Apples", "Coffee Ice Cream")`:
    ## ! longer object length is not a multiple of shorter object length

    ## `summarise()` has grouped output by 'product_name'. You can override using the
    ## `.groups` argument.

| product_name     |        0 |        1 |        2 |       3 |        4 |        5 |        6 |
|:-----------------|---------:|---------:|---------:|--------:|---------:|---------:|---------:|
| Coffee Ice Cream | 13.22222 | 15.00000 | 15.33333 | 15.4000 | 15.16667 | 10.33333 | 12.35294 |
| Pink Lady Apples | 12.25000 | 11.67857 | 12.00000 | 13.9375 | 11.90909 | 13.86957 | 11.55556 |

# Problem 2

``` r
BRFSS <- brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  mutate(response = response %>%
           fct_recode("Poor" = "Poor", "Fair" = "Fair", "Good" = "Good", "Very good" = "Very good", "Excellent" = "Excellent")) 
```

``` r
BRFSS %>%
  filter(year == 2002) %>%
  distinct(locationabbr, year, locationdesc) %>%
  group_by(locationabbr) %>%
  summarize(n_obs = n()) %>%
  filter(n_obs >= 7) %>%
  knitr::kable()
```

| locationabbr | n_obs |
|:-------------|------:|
| CT           |     7 |
| FL           |     7 |
| MA           |     8 |
| NC           |     7 |
| NJ           |     8 |
| PA           |    10 |

There are 7 states with more than 7 observations in 2002.

``` r
BRFSS %>%
  filter(year == 2010) %>%
  distinct(locationabbr, year, locationdesc) %>%
  group_by(locationabbr) %>%
  summarize(n_obs = n()) %>%
  filter(n_obs >= 7) %>%
  knitr::kable()
```

| locationabbr | n_obs |
|:-------------|------:|
| CA           |    12 |
| CO           |     7 |
| FL           |    41 |
| MA           |     9 |
| MD           |    12 |
| NC           |    12 |
| NE           |    10 |
| NJ           |    19 |
| NY           |     9 |
| OH           |     8 |
| PA           |     7 |
| SC           |     7 |
| TX           |    16 |
| WA           |    10 |

There are 14 states with ore than 7 observations in 2010.

``` r
BRFSS %>%
  janitor::clean_names() %>%
  filter(response == "Excellent") %>%
  group_by(locationabbr, year) %>% 
  mutate(mean_DV = mean(data_value)) %>%
  select(year, locationabbr, mean_DV) %>% #locastiondesc
  ggplot(aes(x = year, y = mean_DV)) + 
  geom_line(aes(group = locationabbr)) + 
  geom_smooth()
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

    ## Warning: Removed 71 rows containing non-finite values (`stat_smooth()`).

    ## Warning: Computation failed in `stat_smooth()`
    ## Caused by error in `smooth.construct.cr.smooth.spec()`:
    ## ! x has insufficient unique values to support 10 knots: reduce k.

    ## Warning: Removed 65 rows containing missing values (`geom_line()`).

![](p8105_hw3_jl5934_files/figure-gfm/average%20state%20excellent-1.png)<!-- -->

``` r
  labs(x = "Year", y = "Mean Data Value", title = "Plot of mean value by year for each state", locationabbr = "State Abbreviation")  
```

    ## $x
    ## [1] "Year"
    ## 
    ## $y
    ## [1] "Mean Data Value"
    ## 
    ## $locationabbr
    ## [1] "State Abbreviation"
    ## 
    ## $title
    ## [1] "Plot of mean value by year for each state"
    ## 
    ## attr(,"class")
    ## [1] "labels"

When plotting the mean values of `data_value` for the multiple locations
of a state, by year we are able to create a sphagetti plot showing the
changes from 2002-2010.

``` r
brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(year == c("2006", "2010"), locationabbr == "NY", topic == "Overall Health") %>%
  group_by(response, locationdesc) %>%
  mutate(mean_DV = mean(data_value)) %>%
  ggplot(aes(x= locationdesc, y = mean_DV, color = response)) + 
  geom_bar(stat = "identity") +
  labs(x = "Response Level", y = "Mean Data Value", title = "Mean data Values per response of NY counties in 2006 and 2010", locationdesc = "NY County") +
  facet_grid(rows = vars(year))
```

    ## Warning: There was 1 warning in `filter()`.
    ## ℹ In argument: `year == c("2006", "2010")`.
    ## Caused by warning in `year == c("2006", "2010")`:
    ## ! longer object length is not a multiple of shorter object length

![](p8105_hw3_jl5934_files/figure-gfm/data%20values%20for%20NY%20across%20years-1.png)<!-- -->

We have plotted the mean `data_value` for each location within NY (Bronx
County, Erie County, Kings County, Monroe County, Nassau County, New
York County, Queens County, Suffolk County, & Westchester County) for
the years 2006 and 2010 separately.

# Problem 3

We will import the dataframes from NHANES for the acceleratomer data
`accel.df` and demographic data `covar.df`. We will filter out subhects
from the demographic dataframe `covar.df` based on age (remove those
less than 21 years), remove those with missing demographic data, and
recode `education` and `sex` as appropriate factors.

We will then combine them by `inner_join` to select out only subjects
who met the inclusion criteria from the filters placed on `covar.df`.

``` r
accel.df <- read_csv("p8105_hw3_jl5934_files/data/nhanes_accel.csv") %>%
  janitor::clean_names()
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
covar.df <- read_csv("p8105_hw3_jl5934_files/data/nhanes_covar.csv",
                     skip = 4) %>%
  janitor::clean_names() %>%
  filter(age > 21) %>%
  na.omit() %>%
  mutate(education = as.factor(education) %>%
           fct_recode("Less_than_HS" = "1", "HS_equivalent" = "2", "More_than_HS" = "3")) %>%
  mutate(sex = as.factor(sex) %>% 
           fct_recode("male" = "1", "female" = "2"))
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accel_covar.df <- inner_join(covar.df, accel.df, by = "seqn")
```

Producing a table for count of men and women in each education category.

``` r
accel_covar.df %>%
  group_by(sex, education) %>%
  summarize(n_obs = n())
```

    ## `summarise()` has grouped output by 'sex'. You can override using the `.groups`
    ## argument.

    ## # A tibble: 6 × 3
    ## # Groups:   sex [2]
    ##   sex    education     n_obs
    ##   <fct>  <fct>         <int>
    ## 1 male   Less_than_HS     27
    ## 2 male   HS_equivalent    34
    ## 3 male   More_than_HS     54
    ## 4 female Less_than_HS     28
    ## 5 female HS_equivalent    23
    ## 6 female More_than_HS     59

- For both Males and Females, the majority had education that was more
  than high school equivalent. However in second rank for males was high
  school equivalent and last less then high school; whereas for females
  it was less than high school in second rank then high school
  equivalent in last rank.

Making plot of age distribution by education level and sex.

``` r
accel_covar.df %>%
  group_by(sex, education) %>%
  ggplot(aes(x = age, color = education)) +
  geom_boxplot() +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank()) +
  labs(x = "Age in Years", title = "Age distribution of education levels by sex") +
  facet_grid(rows = vars(sex))
```

![](p8105_hw3_jl5934_files/figure-gfm/plot%20for%20table%20count%20by%20sex/education-1.png)<!-- -->

Next we will make a plot that creates a new variable `Total_activity`
that is the aggregate of the total accelerometer readings for the
24-hour period for an individual.

``` r
accel_covar.df %>%
  mutate(Total_activity = rowSums(.[6:1445])) %>%
  ggplot(aes(x = age, y = Total_activity, color = sex)) +
  geom_point() + 
  geom_smooth(se= FALSE) +
  labs(x = "Age in years", y = "Total Activity", title = "Total activity by age, education, and sex") +
  facet_grid(rows = vars(education))
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](p8105_hw3_jl5934_files/figure-gfm/Total%20activity%20plot-1.png)<!-- -->

- This plot demonstrates that across all education levels and both
  genders, the total activity level decreases with age.

  - For lower education levels there is a trend towards higher overall
    levels of total activity until about age 60 where they all have a
    decrease.

  - In addition, females tend to have lower total activity levels across
    all education levels at younger ages, but this flips around 50 years
    for those with less than high school education.

<!-- -->

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](p8105_hw3_jl5934_files/figure-gfm/24-insepction%20by%20eduation%20and%20sex-1.png)<!-- -->

    ## `summarise()` has grouped output by 'minute', 'sex'. You can override using the
    ## `.groups` argument.
    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](p8105_hw3_jl5934_files/figure-gfm/24-insepction%20by%20eduation%20and%20sex-2.png)<!-- -->
