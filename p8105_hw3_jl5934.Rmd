---
title: "p8105_hw3_jl5934"
author: "Jesus Luevano"
date: "2023-10-06"
output: github_document
---

```{r loading}
library(tidyverse)
library(p8105.datasets)
data("instacart")
data("brfss_smart2010")
```

# Problem 1

## Describing the dataset

* There are `r nrow(instacart)` rows and `r ncol(instacart)` columns in the `instacart` dataframe.

* The variables included are `r names(instacart)`.  


* There are `r length(unique(instacart[["aisle_id"]]))` aisles in the dataframe. 

```{r}
instacart %>%
  group_by(aisle_id) %>%
  summarize(n_obs = n()) %>%
  arrange(desc(n_obs))
  
```
 
 * The top 3 aisles from where purchases are ordered from are Aisle 83 (150609 purchases), 24 (150473 purchases), and 123 (78493 purchases).
 
```{r plot}
instacart %>%
  group_by(aisle_id) %>%
  summarize(n_obs = n()) %>%
  filter(n_obs > 10000) %>%
  arrange(desc(n_obs)) %>%
  ggplot(aes(x = aisle_id)) +
  geom_histogram()
```
 
```{r}
instacart %>%
  filter(aisle == c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle, product_name) %>%
  summarize(n_obs = n()) %>%
  arrange(desc(n_obs)) %>%
  slice_max(order_by = n_obs, n = 3)
```
 
```{r}
instacart %>%
  filter(product_name == c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(Mean = mean(order_hour_of_day, na.rm = TRUE)) %>%
  pivot_wider(
    names_from = order_dow,
    values_from = Mean
  )
```
 
 
# Problem 2

```{r}
BRFSS <- brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  mutate(response = response %>%
           fct_recode("Poor" = "Poor", "Fair" = "Fair", "Good" = "Good", "Very good" = "Very good", "Excellent" = "Excellent")) 
```

```{r}
BRFSS %>%
  filter(year == 2002) %>%
  group_by(locationabbr) %>%
  summarize(n_obs = n()) %>%
  filter(n_obs > 7)
```

There are 36 states with ore than 7 observations in 2002.

```{r}
BRFSS %>%
  filter(year == 2010) %>%
  group_by(locationabbr) %>%
  summarize(n_obs = n()) %>%
  filter(n_obs > 7)
```

There are 45 states with ore than 7 observations in 2010.

```{r}
BRFSS %>%
  janitor::clean_names() %>%
  filter(response == "Excellent") %>%
  group_by(locationabbr, locationdesc) %>%
  mutate(mean_DV = mean(data_value)) %>%
  select(year, locationabbr, locationdesc, mean_DV) %>%
  ggplot(aes(x = year, y = mean_DV, group = locationabbr)) + 
  geom_line(aes(color=locationabbr))
  
BRFSS %>%
  janitor::clean_names() %>%
  filter(response == "Excellent") %>%
  group_by(locationabbr) %>%
  mutate(mean_DV = mean(data_value)) %>%
  select(year, locationabbr, mean_DV) %>%
  ggplot(aes(x = year, y = mean_DV, group = locationabbr)) + 
  geom_line(aes(color=locationabbr))
  
```

```{r}
p <- brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(year == c("2006", "2010"), locationabbr == "NY", topic == "Overall Health") %>%
  group_by(response, locationdesc) %>%
  mutate(mean_DV = mean(data_value)) %>%
  ggplot(aes(x= response, y = mean_DV, color = locationdesc)) + 
  geom_point() 

p + facet_grid(rows = vars(year))

    
```


# Problem 3

```{r}
accel.df <- read_csv("p8105_hw3_jl5934_files/data/nhanes_accel.csv") %>%
  janitor::clean_names()

covar.df <- read_csv("p8105_hw3_jl5934_files/data/nhanes_covar.csv",
                     skip = 4) %>%
  janitor::clean_names() %>%
  filter(age > 21) %>%
  na.omit() %>%
  mutate(education = as.factor(education) %>%
           fct_recode("Less_than_HS" = "1", "HS_equivalent" = "2", "More_than_HS" = "3")) %>%
  mutate(sex = as.factor(sex) %>% 
           fct_recode("male" = "1", "female" = "2"))

accel_covar.df <- inner_join(covar.df, accel.df, by = "seqn")
  
accel_covar.df %>%
  group_by(sex, education) %>%
  summarize(n_obs = n())

```


Making plot of age distribution by education level and sex

```{r}
q <- accel_covar.df %>%
  group_by(sex, education) %>%
  ggplot(aes(x = age, color = education)) +
  geom_boxplot()

q + facet_grid(rows = vars(sex))
```


```{r}
r <- accel_covar.df %>%
  mutate(Total_activity = rowSums(.[6:1445])) %>%
  ggplot(aes(x = age, y = Total_activity, color = sex)) +
  geom_point() + 
  geom_smooth(se= FALSE)

r + facet_grid(rows = vars(education))
```


```{r}
s <- accel_covar.df %>%
  pivot_longer(min1:min1440,
    names_to = "Minute", values_to = "activity") %>%
  ggplot(aes(x = Minute, y = activity, color= sex)) +
  geom_point() +
  geom_smooth(se = TRUE)

s + facet_grid(rows = vars(education))
```

